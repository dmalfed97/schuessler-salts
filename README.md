# Автоматизированная анкета для подбора солей Шюсслера
Работает на node v20, на yarn
По всем вопросам - tg @dmalfed

Команды:
- yarn install - установка пакетов
- yarn build - сборка бандла (готового приложения)
- yarn dev - запуск приложения в локальной среде в режиме разработки

- vercel - позволит производить выкатку на бесплатный удалённый сервер. Потребуется регистрация в сервисе vercel

В настоящий момент разворачивается с помощью серверов vercel - это бесплатно. В случае редактирования кода приложения, необходимо произвести его новую пересборку и выкатку на vercel. После этого, в месте использования необходимо заменить ссылку на развернутое приложение на новую, актуальную. Старая станет недоступна.

Пример источника данных для корректной работы приложения:
https://docs.google.com/spreadsheets/d/1V6u4y2-ctmQ_FdDtL_13nNnEnp6h1Qol/edit?usp=sharing&ouid=113048819080938888826&rtpof=true&sd=true

## Как работает приложение
Приложение предназначено для встройки в WordPress. В иных случаях без модификации кода работать не будет.
Обмен данными с WP идет через window.postMessage()

1. Для открытия первого шага анкеты с заполнением личных данных:
   - Через eventListener к postMessage из parentWindow необходимо отловить json объект с paymentId из postMessage **INITIAL_PAYLOAD**. Иначе анкета не откроется (src/App.tsx)
   - Также, после того как приложение анкеты смонтируется в iframe в DOM, в parentWindow уйдет postMessage **QUESTIONNAIRE_IFRAME_READY** для синхронизации
(Для локальной разработки закомментируйте код в App.tsx, опирающийся на наличие dataFromParent)
  
2. В url iframe анкеты (или в url в режиме разработки или прямого перехода по ссылке) необходимо указать query-param source, значение которого - ссылка на xlsx-документ с анкетой.

### Правила заполнения .xlsx источника данных
